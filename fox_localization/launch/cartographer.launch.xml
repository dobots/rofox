<?xml version="1.0"?>

<launch>

    <arg name="sim_time" default="true"/>
    <arg name="resolution" default="0.05"/>
    <arg name="publish_period_sec" default="1.0"/>

    <arg name="rviz" default="false"/>
    <arg name="rviz_cfg_path" default="$(find-pkg-share fox_localization)/rviz/fox_cartographer.rviz"/>
    
    <!-- cartographer_ros -->
    <arg name="config_dir" default="$(find-pkg-share fox_localization)/config"/>
    <arg name="config_basename" default="fox_lds_2d_slam.lua"/>

    <node pkg="cartographer_ros" exec="cartographer_node" name="cartographer_node" args="-configuration_directory $(var config_dir) -configuration_basename $(var config_basename)" output="screen" >
        <param name="use_sim_time" value="$(var sim_time)"/> <!-- Important to ensure TFs are in correct time alignment -->
    </node>

    <node pkg="cartographer_ros" exec="occupancy_grid_node" name="occupancy_grid_node" args="-resolution $(var resolution) -publish_period_sec $(var publish_period_sec)" output="screen" >
        <param name="use_sim_time" value="$(var sim_time)"/> <!-- Important to ensure TFs are in correct time alignment -->
    </node>
    
    <!-- Rviz (Optional) -->
    <node if="$(var rviz)" name="rviz2_fox_cartographer" pkg="rviz2" exec="rviz2" args="-d $(var rviz_cfg_path)" required="false" output="screen" >
        <param name="use_sim_time" value="$(var sim_time)"/>
    </node>

    <!-- To save a map run:
    ros2 run nav2_map_server map_saver -f <path>
    -->
</launch>